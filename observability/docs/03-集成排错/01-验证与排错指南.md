---
layout: default
title: éªŒè¯ä¸æ’é”™æŒ‡å—
parent: é›†æˆæ’é”™
grand_parent: å¯è§‚æµ‹æ€§å®æˆ˜
nav_order: 1
---

# é›†æˆéªŒè¯ä¸æ’é”™æŒ‡å—

> ğŸ“Š **éš¾åº¦**ï¼šğŸŸ¡ è¿›é˜¶ | â±ï¸ **é˜…è¯»æ—¶é—´**ï¼š20 åˆ†é’Ÿ
>
> ğŸ“ **æœ¬ç« æ‘˜è¦**ï¼šè¿›è¡Œç«¯åˆ°ç«¯çš„æ—¥å¿—é‡‡é›†éªŒè¯ï¼Œå­¦ä¹ å¸¸è§é—®é¢˜çš„æ’æŸ¥æ–¹æ³•å’Œæ€§èƒ½è°ƒä¼˜å»ºè®®ã€‚

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å­¦å®Œæœ¬ç« åï¼Œä½ å°†èƒ½å¤Ÿï¼š

- è¿›è¡Œç«¯åˆ°ç«¯çš„æ—¥å¿—é‡‡é›†éªŒè¯
- æ’æŸ¥ Vector Pod å¯åŠ¨å’Œè¿è¡Œé—®é¢˜
- è¯Šæ–­æ—¥å¿—é‡‡é›†å’Œå‘é€å¤±è´¥çš„åŸå› 
- äº†è§£æ€§èƒ½è°ƒä¼˜çš„å…³é”®å‚æ•°

---

## âœ… ç«¯åˆ°ç«¯éªŒè¯

### éªŒè¯æ­¥éª¤æ¦‚è§ˆ

```mermaid
flowchart TD
    A[1. æ£€æŸ¥ OpenObserve çŠ¶æ€] --> B[2. æ£€æŸ¥ Vector Pod çŠ¶æ€]
    B --> C[3. ç”Ÿæˆæµ‹è¯•æ—¥å¿—]
    C --> D[4. æ£€æŸ¥ Vector æ—¥å¿—]
    D --> E[5. åœ¨ OpenObserve æŸ¥è¯¢]
    E --> F{æ•°æ®æ˜¯å¦å‡ºç°?}
    F -->|æ˜¯| G[éªŒè¯æˆåŠŸ âœ…]
    F -->|å¦| H[è¿›å…¥æ’é”™æµç¨‹]
```

### æ­¥éª¤ 1ï¼šæ£€æŸ¥ OpenObserve çŠ¶æ€

```bash
# æ£€æŸ¥ Pod çŠ¶æ€
kubectl get pods -n openobserve -l app.kubernetes.io/name=openobserve

# æ£€æŸ¥ Service
kubectl get svc -n openobserve

# æµ‹è¯• API è¿é€šæ€§
kubectl run curl-test --rm -it --image=curlimages/curl --restart=Never -- \
  curl -s -o /dev/null -w "%{http_code}" \
  http://openobserve.openobserve:5080/healthz
```

**âœ… æ£€æŸ¥ç‚¹ï¼š** 
- Pod çŠ¶æ€ä¸º `Running`
- HTTP å“åº”ç ä¸º `200`

---

### æ­¥éª¤ 2ï¼šæ£€æŸ¥ Vector Pod çŠ¶æ€

```bash
# æ£€æŸ¥ DaemonSet çŠ¶æ€
kubectl get daemonset -n openobserve -l app.kubernetes.io/name=vector

# æ£€æŸ¥æ‰€æœ‰ Vector Pod
kubectl get pods -n openobserve -l app.kubernetes.io/name=vector -o wide

# æ£€æŸ¥ Pod äº‹ä»¶
kubectl describe pod -n openobserve -l app.kubernetes.io/name=vector | grep -A 10 Events
```

**âœ… æ£€æŸ¥ç‚¹ï¼š**
- DaemonSet READY æ•°é‡ç­‰äºèŠ‚ç‚¹æ•°
- æ‰€æœ‰ Pod çŠ¶æ€ä¸º `Running`
- æ— å¼‚å¸¸äº‹ä»¶

---

### æ­¥éª¤ 3ï¼šç”Ÿæˆæµ‹è¯•æ—¥å¿—

```bash
# æ–¹æ³• 1ï¼šåœ¨èŠ‚ç‚¹ä¸Šç›´æ¥åˆ›å»ºï¼ˆéœ€è¦ SSH åˆ°èŠ‚ç‚¹ï¼‰
echo '{"level":"INFO","msg":"E2E Test Log","timestamp":"2025-01-28T12:00:00Z","source":"test"}' \
  >> /var/logs/e2e-test.log

# æ–¹æ³• 2ï¼šé€šè¿‡ DaemonSet Pod åˆ›å»º
kubectl exec -n openobserve $(kubectl get pods -n openobserve -l app.kubernetes.io/name=vector -o jsonpath='{.items[0].metadata.name}') -- \
  sh -c 'echo "{\"level\":\"INFO\",\"msg\":\"E2E Test\",\"time\":\"$(date -Iseconds)\"}" >> /var/logs/e2e-test.log'
```

---

### æ­¥éª¤ 4ï¼šæ£€æŸ¥ Vector æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
kubectl logs -n openobserve -l app.kubernetes.io/name=vector --tail=100

# è¿‡æ»¤å…³é”®ä¿¡æ¯
kubectl logs -n openobserve -l app.kubernetes.io/name=vector --tail=200 | \
  grep -E "(INFO|WARN|ERROR|e2e-test)"
```

**âœ… æ£€æŸ¥ç‚¹ï¼š** åº”çœ‹åˆ°ç±»ä¼¼æ—¥å¿—ï¼š

```
INFO vector::sources::file: Starting file source
INFO vector::sinks::http: Request successful
```

---

### æ­¥éª¤ 5ï¼šåœ¨ OpenObserve æŸ¥è¯¢

1. è®¿é—® OpenObserve Web UI
2. è¿›å…¥ **Logs** é¡µé¢
3. é€‰æ‹© **Stream**: `application`
4. è®¾ç½®æ—¶é—´èŒƒå›´ï¼š**Last 15 minutes**
5. æœç´¢ï¼š`msg:"E2E Test"`

**âœ… æ£€æŸ¥ç‚¹ï¼š** åº”çœ‹åˆ°æµ‹è¯•æ—¥å¿—è®°å½•ã€‚

---

### éªŒè¯æ£€æŸ¥æ¸…å•

| åºå· | æ£€æŸ¥é¡¹ | å‘½ä»¤/æ“ä½œ | é¢„æœŸç»“æœ |
|:----:|--------|----------|---------|
| 1 | OpenObserve Pod | `kubectl get pods -n openobserve` | Running |
| 2 | Vector DaemonSet | `kubectl get ds -n openobserve` | READY = èŠ‚ç‚¹æ•° |
| 3 | ç½‘ç»œè¿é€šæ€§ | `curl healthz` | HTTP 200 |
| 4 | Vector æ—¥å¿— | `kubectl logs` | æ—  ERROR |
| 5 | æ•°æ®æŸ¥è¯¢ | OpenObserve UI | æ•°æ®å¯è§ |

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’é”™

### æ’é”™å†³ç­–æ ‘

```mermaid
flowchart TD
    START[æ—¥å¿—æœªå‡ºç°åœ¨ OpenObserve] --> Q1{Vector Pod è¿è¡Œä¸­?}
    
    Q1 -->|å¦| A1[æ£€æŸ¥ Pod äº‹ä»¶å’Œæ—¥å¿—]
    Q1 -->|æ˜¯| Q2{Vector æ—¥å¿—æœ‰é”™è¯¯?}
    
    Q2 -->|æœ‰| A2[åˆ†æé”™è¯¯ä¿¡æ¯]
    Q2 -->|æ— | Q3{æ—¥å¿—æ–‡ä»¶å­˜åœ¨?}
    
    Q3 -->|å¦| A3[æ£€æŸ¥æ—¥å¿—è·¯å¾„é…ç½®]
    Q3 -->|æ˜¯| Q4{æ–‡ä»¶è·¯å¾„åŒ¹é… include?}
    
    Q4 -->|å¦| A4[ä¿®æ”¹ include è§„åˆ™]
    Q4 -->|æ˜¯| Q5{ç½‘ç»œè¿é€š?}
    
    Q5 -->|å¦| A5[æ£€æŸ¥ Service å’Œç½‘ç»œç­–ç•¥]
    Q5 -->|æ˜¯| Q6{è®¤è¯æ­£ç¡®?}
    
    Q6 -->|å¦| A6[æ›´æ–°ç”¨æˆ·åå¯†ç ]
    Q6 -->|æ˜¯| A7[æ£€æŸ¥ OpenObserve æ—¥å¿—]
```

---

### é—®é¢˜ 1ï¼šVector Pod æœªè¿è¡Œ

**ç—‡çŠ¶ï¼š**
```
NAME           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE
vector         3         3         0       3            0
```

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# æŸ¥çœ‹ Pod çŠ¶æ€
kubectl get pods -n openobserve -l app.kubernetes.io/name=vector

# æŸ¥çœ‹ Pod è¯¦æƒ…
kubectl describe pod -n openobserve -l app.kubernetes.io/name=vector

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs -n openobserve -l app.kubernetes.io/name=vector
```

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š**

| åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| é•œåƒæ‹‰å–å¤±è´¥ | æ£€æŸ¥é•œåƒåç§°å’Œç½‘ç»œï¼›é…ç½®é•œåƒæ‹‰å– Secret |
| èµ„æºä¸è¶³ | é™ä½ resources.requests |
| å·æŒ‚è½½å¤±è´¥ | æ£€æŸ¥ hostPath æ˜¯å¦å­˜åœ¨ |
| é…ç½®é”™è¯¯ | éªŒè¯ values.yaml è¯­æ³• |

---

### é—®é¢˜ 2ï¼šæ—¥å¿—æœªè¢«é‡‡é›†

**ç—‡çŠ¶ï¼š** Vector è¿è¡Œæ­£å¸¸ï¼Œä½† OpenObserve æ— æ•°æ®ã€‚

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨
kubectl exec -n openobserve <vector-pod> -- ls -la /var/logs/

# 2. æ£€æŸ¥ Vector å†…éƒ¨æŒ‡æ ‡
kubectl exec -n openobserve <vector-pod> -- \
  curl -s http://127.0.0.1:8686/metrics | grep vector_

# 3. æ£€æŸ¥ file source çŠ¶æ€
kubectl logs -n openobserve <vector-pod> | grep "file source"
```

**å¸¸è§åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š**

| åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| è·¯å¾„ä¸åŒ¹é… | æ£€æŸ¥ `include` glob æ¨¡å¼ |
| æ–‡ä»¶è¢« exclude | ç§»é™¤é”™è¯¯çš„ exclude è§„åˆ™ |
| æ–‡ä»¶è¿‡æ—§ | è°ƒæ•´ `ignore_older_secs` |
| æƒé™é—®é¢˜ | æ£€æŸ¥ hostPath æŒ‚è½½æƒé™ |

**éªŒè¯ glob æ¨¡å¼ï¼š**

```bash
# åœ¨ Vector Pod å†…æµ‹è¯•è·¯å¾„åŒ¹é…
kubectl exec -n openobserve <vector-pod> -- \
  find /var/logs -name "*.log" -type f 2>/dev/null
```

---

### é—®é¢˜ 3ï¼šæ•°æ®æœªåˆ°è¾¾ OpenObserve

**ç—‡çŠ¶ï¼š** Vector é‡‡é›†åˆ°æ—¥å¿—ï¼Œä½†å‘é€å¤±è´¥ã€‚

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥ Vector sink æ—¥å¿—
kubectl logs -n openobserve <vector-pod> | grep -E "(sink|http|error)"

# 2. æµ‹è¯•ç½‘ç»œè¿é€šæ€§
kubectl exec -n openobserve <vector-pod> -- \
  curl -v http://openobserve.openobserve:5080/healthz

# 3. æµ‹è¯• API è®¤è¯
kubectl exec -n openobserve <vector-pod> -- \
  curl -u "admin@example.com:your-password" \
  -X POST http://openobserve.openobserve:5080/api/default/test/_json \
  -H "Content-Type: application/json" \
  -d '[{"msg":"test"}]'
```

**å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆï¼š**

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `Connection refused` | Service ä¸å­˜åœ¨æˆ–ç«¯å£é”™è¯¯ | æ£€æŸ¥ Service åç§°å’Œç«¯å£ |
| `401 Unauthorized` | è®¤è¯å¤±è´¥ | æ›´æ–° user/password |
| `404 Not Found` | API è·¯å¾„é”™è¯¯ | æ£€æŸ¥ uri æ ¼å¼ |
| `Request timeout` | ç½‘ç»œé—®é¢˜æˆ– OpenObserve è¿‡è½½ | æ£€æŸ¥ç½‘ç»œç­–ç•¥ï¼›å¢åŠ èµ„æº |

---

### é—®é¢˜ 4ï¼šJSON è§£æå¤±è´¥

**ç—‡çŠ¶ï¼š** Vector æ—¥å¿—æ˜¾ç¤º `parse_json` å¤±è´¥ã€‚

**é”™è¯¯ç¤ºä¾‹ï¼š**

```
WARN transform{component_kind="transform" component_id=parse_json}: 
  vector::transforms::remap: Remap error. error="function call error: 
  unable to parse json: expected value at line 1 column 1"
```

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# æŸ¥çœ‹åŸå§‹æ—¥å¿—æ ¼å¼
kubectl exec -n openobserve <vector-pod> -- \
  head -5 /var/logs/your-app.log
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **é JSON æ—¥å¿—**ï¼šä¿®æ”¹ transform æˆ–ç§»é™¤ JSON è§£æ

```yaml
transforms:
  add_metadata:
    type: "remap"
    inputs: ["application_logs"]
    source: |-
      # ä¿ç•™åŸå§‹æ¶ˆæ¯ï¼Œæ·»åŠ å…ƒæ•°æ®
      .raw_message = .message
      .source = "vector"
```

2. **JSON æ ¼å¼é”™è¯¯**ï¼šä¿®å¤åº”ç”¨æ—¥å¿—è¾“å‡º

3. **ä½¿ç”¨å®¹é”™è§£æ**ï¼š

```yaml
source: |-
  # å°è¯•è§£æ JSONï¼Œå¤±è´¥åˆ™ä¿ç•™åŸå§‹æ¶ˆæ¯
  parsed, err = parse_json(.message)
  if err == null {
    . = parsed
  }
```

---

## ğŸ“Š æ—¥å¿—ä¸ç›‘æ§

### Vector å†…éƒ¨æŒ‡æ ‡

Vector æš´éœ² Prometheus æ ¼å¼çš„æŒ‡æ ‡ï¼š

```bash
# è·å– Vector æŒ‡æ ‡
kubectl exec -n openobserve <vector-pod> -- \
  curl -s http://127.0.0.1:8686/metrics
```

**å…³é”®æŒ‡æ ‡ï¼š**

| æŒ‡æ ‡ | è¯´æ˜ |
|------|------|
| `vector_component_received_events_total` | æ¥æ”¶çš„äº‹ä»¶æ•° |
| `vector_component_sent_events_total` | å‘é€çš„äº‹ä»¶æ•° |
| `vector_component_errors_total` | é”™è¯¯æ•° |
| `vector_buffer_events` | ç¼“å†²åŒºäº‹ä»¶æ•° |

### OpenObserve å¥åº·æ£€æŸ¥

```bash
# å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl http://openobserve.openobserve:5080/healthz

# API çŠ¶æ€
curl -u "admin@example.com:password" \
  http://openobserve.openobserve:5080/api/default/_streams
```

---

## âš¡ æ€§èƒ½è°ƒä¼˜å»ºè®®

### Vector é…ç½®ä¼˜åŒ–

| é…ç½®é¡¹ | è¯´æ˜ | å»ºè®®å€¼ |
|--------|------|--------|
| `batch.max_bytes` | æ‰¹é‡å¤§å° | 5-10 MB |
| `batch.timeout_secs` | æ‰¹é‡è¶…æ—¶ | 5-10 ç§’ |
| `request.concurrency` | å¹¶å‘è¯·æ±‚æ•° | æ ¹æ®ç›®æ ‡æ‰¿å—èƒ½åŠ› |
| `buffer.type` | ç¼“å†²ç±»å‹ | `disk`ï¼ˆç”Ÿäº§ï¼‰/ `memory`ï¼ˆæµ‹è¯•ï¼‰ |

**é«˜ååé‡é…ç½®ç¤ºä¾‹ï¼š**

```yaml
sinks:
  openobserve:
    # ... å…¶ä»–é…ç½® ...
    batch:
      max_bytes: 10485760    # 10MB
      max_events: 10000      # æœ€å¤§äº‹ä»¶æ•°
      timeout_secs: 5
    buffer:
      type: disk
      max_size: 268435488    # 256MB
    request:
      concurrency: 10
      rate_limit_num: 100
      rate_limit_duration_secs: 1
```

### èµ„æºé…ç½®å»ºè®®

| åœºæ™¯ | CPU | å†…å­˜ |
|------|-----|------|
| å°å‹ï¼ˆ< 100 logs/sï¼‰ | 100m | 128Mi |
| ä¸­å‹ï¼ˆ100-1000 logs/sï¼‰ | 500m | 512Mi |
| å¤§å‹ï¼ˆ> 1000 logs/sï¼‰ | 1000m | 1Gi |

---

## â“ å¸¸è§é—®é¢˜ FAQ

| é—®é¢˜ | è§£ç­” |
|------|------|
| **Vector Pod é‡å¯å¾ªç¯** | æ£€æŸ¥ OOM æˆ–é…ç½®é”™è¯¯ï¼›å¢åŠ å†…å­˜é™åˆ¶æˆ–ç®€åŒ–é…ç½® |
| **æ—¥å¿—å»¶è¿Ÿè¿‡é«˜** | å‡å° `batch.timeout_secs`ï¼›å¢åŠ  `concurrency` |
| **ç£ç›˜ç©ºé—´ä¸è¶³** | è®¾ç½® `buffer.max_size`ï¼›é…ç½® `ignore_older_secs` |
| **éƒ¨åˆ†æ—¥å¿—ä¸¢å¤±** | å¯ç”¨ `disk` bufferï¼›æ£€æŸ¥ `acknowledgements` |
| **CPU ä½¿ç”¨è¿‡é«˜** | ç®€åŒ– transform é€»è¾‘ï¼›å¢åŠ  `batch.timeout_secs` |
| **å†…å­˜æŒç»­å¢é•¿** | æ£€æŸ¥ buffer é…ç½®ï¼›è®¾ç½®å†…å­˜é™åˆ¶ |
| **è®¤è¯çªç„¶å¤±è´¥** | OpenObserve å¯†ç å¯èƒ½å·²æ›´æ–°ï¼›æ£€æŸ¥ Secret åŒæ­¥ |
| **Stream ä¸å­˜åœ¨** | OpenObserve ä¼šè‡ªåŠ¨åˆ›å»ºï¼›æ£€æŸ¥ API è·¯å¾„æ‹¼å†™ |

---

## æ€»ç»“

æœ¬ç« æˆ‘ä»¬å®Œæˆäº†ï¼š

1. âœ… ç«¯åˆ°ç«¯çš„æ—¥å¿—é‡‡é›†éªŒè¯æµç¨‹
2. âœ… å¸¸è§é—®é¢˜çš„è¯Šæ–­æ–¹æ³•ï¼ˆæ’é”™å†³ç­–æ ‘ï¼‰
3. âœ… 4 ç±»å…¸å‹é—®é¢˜çš„è¯¦ç»†æ’æŸ¥æ­¥éª¤
4. âœ… æ€§èƒ½è°ƒä¼˜çš„å…³é”®å‚æ•°å’Œå»ºè®®

è‡³æ­¤ï¼ŒOpenObserve + Vector çš„ Kubernetes æ—¥å¿—é‡‡é›†ç³»åˆ—å®Œæˆã€‚ä½ å·²ç»æŒæ¡äº†ï¼š

- æ•´ä½“æ¶æ„è®¾è®¡
- OpenObserve Standalone éƒ¨ç½²
- Vector DaemonSet é…ç½®
- ç«¯åˆ°ç«¯éªŒè¯ä¸æ’é”™

---

## ğŸ”— åç»­å­¦ä¹ 

- **MinIO å­˜å‚¨é…ç½®**ï¼šç”Ÿäº§ç¯å¢ƒçš„å¯¹è±¡å­˜å‚¨åç«¯ï¼ˆåç»­åšå®¢ï¼‰
- **å‘Šè­¦é…ç½®**ï¼šåŸºäºæ—¥å¿—çš„å‘Šè­¦è§„åˆ™
- **Dashboard æ„å»º**ï¼šå¯è§†åŒ–æ—¥å¿—åˆ†æä»ªè¡¨æ¿

---

| â¬…ï¸ ä¸Šä¸€ç«  | ğŸ  ç›®å½• | ä¸‹ä¸€ç«  â¡ï¸ |
|:----------|:------:|----------:|
| [Vector DaemonSet é…ç½®ä¸éƒ¨ç½²](../02-Vectoréƒ¨ç½²/01-DaemonSeté…ç½®ä¸éƒ¨ç½².md) | [è¿”å›ç›®å½•](../../) | - |

