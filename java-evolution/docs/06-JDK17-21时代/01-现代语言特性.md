---
layout: default
title: ç°ä»£è¯­è¨€ç‰¹æ€§
parent: JDK 17-21 æ—¶ä»£
grand_parent: JavaæŠ€æœ¯ç”Ÿæ€æ¼”è¿›
nav_order: 1
---

# ç°ä»£è¯­è¨€ç‰¹æ€§

<p align="center">
  <img src="https://img.shields.io/badge/éš¾åº¦-è¿›é˜¶-yellow" alt="éš¾åº¦">
  <img src="https://img.shields.io/badge/é˜…è¯»æ—¶é•¿-45åˆ†é’Ÿ-blue" alt="æ—¶é•¿">
  <img src="https://img.shields.io/badge/JDK-14~21-red" alt="JDK">
</p>

---

## ğŸ“ æ—¶é—´çº¿å®šä½

```mermaid
timeline
    title JDK 14-21 è¯­è¨€ç‰¹æ€§
    section JDK 14-16
        æ•°æ®è½½ä½“ : Record (Preview â†’ Final)
        ç»§æ‰¿æ§åˆ¶ : Sealed Classes (Preview)
        æ¨¡å¼åŒ¹é… : instanceof Pattern
    section JDK 17 LTS
        ç¨³å®šç‰ˆ : ğŸ“ Record, Sealed æ­£å¼
               : Switch Pattern (Preview)
    section JDK 21 LTS
        æˆç†Ÿç‰ˆ : Pattern Matching å®Œå–„
               : String Templates (Preview)
```

---

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- âœ… æŒæ¡ Record ç±»çš„è¯­æ³•ä¸ä½¿ç”¨åœºæ™¯
- âœ… ç†è§£ Sealed Classes çš„è®¾è®¡ç›®çš„
- âœ… äº†è§£ Pattern Matching çš„æ¼”è¿›ä¸åº”ç”¨
- âœ… è®¤è¯†è¿™äº›ç‰¹æ€§å¯¹æ¡†æ¶çš„å½±å“

---

## ğŸ“– ç« èŠ‚æ‘˜è¦

JDK 14-21 å¸¦æ¥äº†å¤§é‡è¯­è¨€æ”¹è¿›ï¼Œè®© Java ä»£ç æ›´åŠ ç®€æ´ã€å®‰å…¨ã€‚Record ç®€åŒ–äº†æ•°æ®è½½ä½“ï¼ŒSealed Classes æ§åˆ¶ç»§æ‰¿ï¼ŒPattern Matching è®©ç±»å‹æ£€æŸ¥æ›´ä¼˜é›…ã€‚

---

## 1. Record ç±»

### 1.1 ä¼ ç»Ÿ POJO çš„ç—›ç‚¹

```java
// ä¼ ç»Ÿ POJOï¼šå¤§é‡æ ·æ¿ä»£ç 
public class User {
    private final String name;
    private final int age;
    
    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }
    
    public String getName() { return name; }
    public int getAge() { return age; }
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        User user = (User) o;
        return age == user.age && Objects.equals(name, user.name);
    }
    
    @Override
    public int hashCode() {
        return Objects.hash(name, age);
    }
    
    @Override
    public String toString() {
        return "User{name='" + name + "', age=" + age + "}";
    }
}
```

### 1.2 Record è¯­æ³•

```java
// JDK 16+: Record ä¸€è¡Œæå®š
public record User(String name, int age) {}

// è‡ªåŠ¨ç”Ÿæˆï¼š
// - ç§æœ‰ final å­—æ®µ
// - å…¨å‚æ„é€ å‡½æ•°
// - getter æ–¹æ³•ï¼ˆname(), age()ï¼‰
// - equals(), hashCode(), toString()

// ä½¿ç”¨
User user = new User("Alice", 30);
System.out.println(user.name());  // Alice
System.out.println(user);         // User[name=Alice, age=30]
```

### 1.3 Record é«˜çº§ç”¨æ³•

```java
// ç´§å‡‘æ„é€ å‡½æ•°ï¼ˆå‚æ•°éªŒè¯ï¼‰
public record User(String name, int age) {
    public User {
        Objects.requireNonNull(name, "name cannot be null");
        if (age < 0) throw new IllegalArgumentException("age cannot be negative");
    }
}

// é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•
public record Point(int x, int y) {
    // é™æ€å·¥å‚
    public static Point origin() {
        return new Point(0, 0);
    }
    
    // å®ä¾‹æ–¹æ³•
    public double distanceFromOrigin() {
        return Math.sqrt(x * x + y * y);
    }
}

// å®ç°æ¥å£
public record User(String name, int age) implements Comparable<User> {
    @Override
    public int compareTo(User other) {
        return Integer.compare(this.age, other.age);
    }
}
```

### 1.4 Record é™åˆ¶

```java
// âŒ ä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»ï¼ˆéšå¼ç»§æ‰¿ java.lang.Recordï¼‰
// âŒ ä¸èƒ½å£°æ˜å®ä¾‹å­—æ®µï¼ˆåªæœ‰ç»„ä»¶å­—æ®µï¼‰
// âŒ å­—æ®µè‡ªåŠ¨æ˜¯ finalï¼ˆä¸å¯å˜ï¼‰
// âœ… å¯ä»¥å®ç°æ¥å£
// âœ… å¯ä»¥æœ‰é™æ€å­—æ®µå’Œæ–¹æ³•
```

---

## 2. Sealed Classes

### 2.1 è®¾è®¡ç›®çš„

```java
// é—®é¢˜ï¼šå¦‚ä½•é™åˆ¶å“ªäº›ç±»å¯ä»¥ç»§æ‰¿ï¼Ÿ
// ä¼ ç»Ÿæ–¹å¼ï¼šfinal æˆ– package-private

// Sealed Classesï¼šç²¾ç¡®æ§åˆ¶ç»§æ‰¿
public sealed class Shape 
    permits Circle, Rectangle, Triangle {
}

// å¿…é¡»æ˜¯ finalã€sealed æˆ– non-sealed
public final class Circle extends Shape {
    private final double radius;
}

public sealed class Rectangle extends Shape 
    permits Square {
    private final double width, height;
}

public final class Square extends Rectangle {
}

// non-sealed å¼€æ”¾ç»§æ‰¿
public non-sealed class Triangle extends Shape {
}
```

### 2.2 ä¸ Pattern Matching ç»“åˆ

```java
// Sealed + Pattern Matching = ç©·å°½æ€§æ£€æŸ¥
public double area(Shape shape) {
    return switch (shape) {
        case Circle c -> Math.PI * c.radius() * c.radius();
        case Rectangle r -> r.width() * r.height();
        case Triangle t -> 0.5 * t.base() * t.height();
        // ç¼–è¯‘å™¨çŸ¥é“æ‰€æœ‰å¯èƒ½çš„å­ç±»ï¼Œæ— éœ€ default
    };
}
```

---

## 3. Pattern Matching

### 3.1 instanceof Patternï¼ˆJDK 16ï¼‰

```java
// ========== ä¼ ç»Ÿæ–¹å¼ ==========
if (obj instanceof String) {
    String s = (String) obj;
    System.out.println(s.length());
}

// ========== Pattern Matching ==========
if (obj instanceof String s) {
    System.out.println(s.length());  // ç›´æ¥ä½¿ç”¨ s
}

// é…åˆæ¡ä»¶
if (obj instanceof String s && s.length() > 5) {
    System.out.println(s);
}
```

### 3.2 Switch Patternï¼ˆJDK 21ï¼‰

```java
// ä¼ ç»Ÿ switch
String format(Object obj) {
    if (obj instanceof Integer i) {
        return String.format("int %d", i);
    } else if (obj instanceof Double d) {
        return String.format("double %f", d);
    } else if (obj instanceof String s) {
        return String.format("String %s", s);
    }
    return obj.toString();
}

// Pattern Matching switch
String format(Object obj) {
    return switch (obj) {
        case Integer i -> String.format("int %d", i);
        case Double d -> String.format("double %f", d);
        case String s -> String.format("String %s", s);
        case null -> "null";
        default -> obj.toString();
    };
}
```

### 3.3 Record Patternï¼ˆJDK 21ï¼‰

```java
record Point(int x, int y) {}
record Line(Point start, Point end) {}

// è§£æ„ Record
void printPoint(Object obj) {
    if (obj instanceof Point(int x, int y)) {
        System.out.println("x=" + x + ", y=" + y);
    }
}

// åµŒå¥—è§£æ„
void printLine(Object obj) {
    if (obj instanceof Line(Point(int x1, int y1), Point(int x2, int y2))) {
        System.out.println("Line from (" + x1 + "," + y1 + ") to (" + x2 + "," + y2 + ")");
    }
}

// Switch ä¸­ä½¿ç”¨
String describe(Object obj) {
    return switch (obj) {
        case Point(int x, int y) when x == y -> "å¯¹è§’ç‚¹";
        case Point(int x, int y) -> "ç‚¹ (" + x + ", " + y + ")";
        case Line(Point p1, Point p2) -> "çº¿æ®µ";
        default -> "æœªçŸ¥";
    };
}
```

---

## 4. å…¶ä»–æ”¹è¿›

### 4.1 Text Blocksï¼ˆJDK 15ï¼‰

```java
// ä¼ ç»Ÿå¤šè¡Œå­—ç¬¦ä¸²
String json = "{\n" +
              "  \"name\": \"Alice\",\n" +
              "  \"age\": 30\n" +
              "}";

// Text Blocks
String json = """
    {
      "name": "Alice",
      "age": 30
    }
    """;
```

### 4.2 Switch è¡¨è¾¾å¼ï¼ˆJDK 14ï¼‰

```java
// ä¼ ç»Ÿ switch
int numLetters;
switch (day) {
    case MONDAY:
    case FRIDAY:
    case SUNDAY:
        numLetters = 6;
        break;
    case TUESDAY:
        numLetters = 7;
        break;
    // ...
}

// Switch è¡¨è¾¾å¼
int numLetters = switch (day) {
    case MONDAY, FRIDAY, SUNDAY -> 6;
    case TUESDAY -> 7;
    case THURSDAY, SATURDAY -> 8;
    case WEDNESDAY -> 9;
};
```

---

## 5. ä»£ç æ¼”è¿›ç¤ºä¾‹

```java
// ========== JDK 8 å†™æ³• ==========
public class User {
    private final String name;
    private final int age;
    // æ„é€ å‡½æ•°ã€getterã€equalsã€hashCodeã€toString...
}

public void process(Object obj) {
    if (obj instanceof User) {
        User user = (User) obj;
        if (user.getAge() > 18) {
            System.out.println(user.getName());
        }
    }
}

// ========== JDK 21 å†™æ³• ==========
public record User(String name, int age) {}

public void process(Object obj) {
    if (obj instanceof User(String name, int age) && age > 18) {
        System.out.println(name);
    }
}
```

---

## 6. æŠ€æœ¯å…³è”åˆ†æ

### 6.1 å¯¹æ¡†æ¶çš„å½±å“

| ç‰¹æ€§ | æ¡†æ¶å½±å“ |
|------|----------|
| Record | JSON åºåˆ—åŒ–åº“é€‚é…ã€JPA è€ƒè™‘æ”¯æŒ |
| Sealed | é¢†åŸŸå»ºæ¨¡æ›´ç²¾ç¡® |
| Pattern | å‡å°‘ç±»å‹æ£€æŸ¥æ ·æ¿ä»£ç  |

### 6.2 ä¸ Lombok çš„å¯¹æ¯”

| ç»´åº¦ | Record | Lombok |
|------|--------|--------|
| å®šä½ | ä¸å¯å˜æ•°æ®è½½ä½“ | é€šç”¨ä»£ç ç”Ÿæˆ |
| ä¾èµ– | è¯­è¨€åŸç”Ÿ | éœ€è¦ä¾èµ– |
| çµæ´»æ€§ | å—é™ | çµæ´» |
| IDE æ”¯æŒ | å®Œç¾ | éœ€è¦æ’ä»¶ |

---

## 7. æ¼”è¿›è§„å¾‹æ€»ç»“

### 7.1 å‡å°‘æ ·æ¿ä»£ç 

```
æ‰‹å†™ POJO â†’ Lombok â†’ Record

è¯­è¨€å±‚é¢è§£å†³é‡å¤ä»£ç é—®é¢˜ã€‚
```

### 7.2 å¢å¼ºç±»å‹å®‰å…¨

```
if-instanceof-cast â†’ Pattern Matching

ç±»å‹æ£€æŸ¥å’Œç»‘å®šä¸€æ­¥å®Œæˆï¼Œæ›´å®‰å…¨ã€‚
```

---

## 8. ç‰¹æ®Šå…ƒç´ 

### ğŸ’¼ é¢è¯•è€ƒç‚¹

**Q1: Record å’Œæ™®é€šç±»çš„åŒºåˆ«ï¼Ÿ**

ç­”ï¼š
- Record éšå¼ç»§æ‰¿ java.lang.Recordï¼Œä¸èƒ½ç»§æ‰¿å…¶ä»–ç±»
- Record å­—æ®µéšå¼ finalï¼Œä¸å¯å˜
- Record è‡ªåŠ¨ç”Ÿæˆ equals/hashCode/toString
- Record æ²¡æœ‰é»˜è®¤æ— å‚æ„é€ å‡½æ•°

**Q2: Sealed Classes çš„åº”ç”¨åœºæ™¯ï¼Ÿ**

ç­”ï¼š
- ç²¾ç¡®æ§åˆ¶ç»§æ‰¿å±‚æ¬¡
- é…åˆ switch pattern matching å®ç°ç©·å°½æ€§æ£€æŸ¥
- ä»£æ•°æ•°æ®ç±»å‹å»ºæ¨¡

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [JEP 395: Records](https://openjdk.org/jeps/395)
- [JEP 409: Sealed Classes](https://openjdk.org/jeps/409)
- [JEP 441: Pattern Matching for switch](https://openjdk.org/jeps/441)

---

<p align="center">
  â¬…ï¸ <a href="../05-JDK9-11æ—¶ä»£/03-äº‘åŸç”ŸåŸºç¡€è®¾æ–½.md">ä¸Šä¸€ç¯‡ï¼šäº‘åŸç”ŸåŸºç¡€è®¾æ–½</a> |
  ğŸ  <a href="../../README.md">è¿”å›ç›®å½•</a> |
  <a href="./02-è™šæ‹Ÿçº¿ç¨‹é©å‘½.md">ä¸‹ä¸€ç¯‡ï¼šè™šæ‹Ÿçº¿ç¨‹é©å‘½</a> â¡ï¸
</p>

