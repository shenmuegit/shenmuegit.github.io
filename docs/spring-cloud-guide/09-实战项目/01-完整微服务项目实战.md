---
layout: default
title: å®Œæ•´å¾®æœåŠ¡é¡¹ç›®å®æˆ˜
parent: å®æˆ˜é¡¹ç›®
grand_parent: Spring Cloud æ•™ç¨‹
nav_order: 1
---

# å®Œæ•´å¾®æœåŠ¡é¡¹ç›®å®æˆ˜

> ğŸ“Š **éš¾åº¦**ï¼šğŸ”´ é«˜çº§ | â±ï¸ **é˜…è¯»æ—¶é—´**ï¼š2 å°æ—¶
> 
> ğŸ“ **æœ¬ç« æ‘˜è¦**ï¼šç»¼åˆè¿ç”¨æ‰€å­¦çŸ¥è¯†ï¼Œæ„å»ºä¸€ä¸ªå®Œæ•´çš„ç”µå•†å¾®æœåŠ¡ç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·ã€å•†å“ã€è®¢å•å’Œæ”¯ä»˜æœåŠ¡ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

å­¦å®Œæœ¬ç« åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- è®¾è®¡å¾®æœåŠ¡æ¶æ„
- åˆ›å»ºå®Œæ•´çš„å¾®æœåŠ¡é¡¹ç›®
- æ•´åˆæ‰€æœ‰ Spring Cloud ç»„ä»¶
- å®ç°æœåŠ¡é—´çš„åä½œ
- éƒ¨ç½²å’Œæµ‹è¯•å¾®æœåŠ¡

---

## é¡¹ç›®éœ€æ±‚åˆ†æ

æˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç®€å•çš„ç”µå•†ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹æœåŠ¡ï¼š

1. **ç”¨æˆ·æœåŠ¡ï¼ˆuser-serviceï¼‰**ï¼šç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æŸ¥è¯¢
2. **å•†å“æœåŠ¡ï¼ˆproduct-serviceï¼‰**ï¼šå•†å“æŸ¥è¯¢ã€åº“å­˜ç®¡ç†
3. **è®¢å•æœåŠ¡ï¼ˆorder-serviceï¼‰**ï¼šè®¢å•åˆ›å»ºã€æŸ¥è¯¢
4. **æ”¯ä»˜æœåŠ¡ï¼ˆpayment-serviceï¼‰**ï¼šæ”¯ä»˜å¤„ç†
5. **Eureka Server**ï¼šæœåŠ¡æ³¨å†Œä¸­å¿ƒ
6. **Config Server**ï¼šé…ç½®ä¸­å¿ƒ
7. **API Gateway**ï¼šAPI ç½‘å…³

### æœåŠ¡è°ƒç”¨å…³ç³»

```
ç”¨æˆ· â†’ API Gateway â†’ ç”¨æˆ·æœåŠ¡
ç”¨æˆ· â†’ API Gateway â†’ å•†å“æœåŠ¡
ç”¨æˆ· â†’ API Gateway â†’ è®¢å•æœåŠ¡ â†’ å•†å“æœåŠ¡
è®¢å•æœåŠ¡ â†’ æ”¯ä»˜æœåŠ¡
```

## é¡¹ç›®æ¶æ„è®¾è®¡

### æŠ€æœ¯æ ˆ

- **Spring Boot 3.2.0**
- **Spring Cloud 2025.0**
- **Eureka**ï¼šæœåŠ¡æ³¨å†Œä¸å‘ç°
- **Spring Cloud Config**ï¼šé…ç½®ä¸­å¿ƒ
- **Spring Cloud Gateway**ï¼šAPI ç½‘å…³
- **OpenFeign**ï¼šæœåŠ¡è°ƒç”¨
- **Resilience4j**ï¼šç†”æ–­é™çº§
- **Spring Cloud Sleuth**ï¼šåˆ†å¸ƒå¼è¿½è¸ª
- **MySQL**ï¼šæ•°æ®åº“
- **Redis**ï¼šç¼“å­˜ï¼ˆå¯é€‰ï¼‰

### é¡¹ç›®ç»“æ„

```
ecommerce-microservices/
â”œâ”€â”€ pom.xml                          # çˆ¶é¡¹ç›®
â”œâ”€â”€ eureka-server/                   # æœåŠ¡æ³¨å†Œä¸­å¿ƒ
â”œâ”€â”€ config-server/                   # é…ç½®ä¸­å¿ƒ
â”œâ”€â”€ api-gateway/                     # API ç½‘å…³
â”œâ”€â”€ user-service/                    # ç”¨æˆ·æœåŠ¡
â”œâ”€â”€ product-service/                 # å•†å“æœåŠ¡
â”œâ”€â”€ order-service/                   # è®¢å•æœåŠ¡
â””â”€â”€ payment-service/                 # æ”¯ä»˜æœåŠ¡
```

## åˆ›å»ºæ‰€æœ‰æœåŠ¡æ¨¡å—

### 1. çˆ¶é¡¹ç›® pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>ecommerce-microservices</artifactId>
    <version>1.0.0</version>
    <packaging>pom</packaging>

    <name>Ecommerce Microservices</name>
    <description>Spring Cloud 2025.0 ç”µå•†å¾®æœåŠ¡é¡¹ç›®</description>

    <properties>
        <java.version>17</java.version>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <spring-boot.version>3.2.0</spring-boot.version>
        <spring-cloud.version>2025.0.0</spring-cloud.version>
    </properties>

    <modules>
        <module>eureka-server</module>
        <module>config-server</module>
        <module>api-gateway</module>
        <module>user-service</module>
        <module>product-service</module>
        <module>order-service</module>
        <module>payment-service</module>
    </modules>

    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-maven-plugin</artifactId>
                    <version>${spring-boot.version}</version>
                </plugin>
            </plugins>
        </pluginManagement>
    </build>
</project>
```

### 2. Eureka Server

**pom.xml**ï¼š
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
    </dependency>
</dependencies>
```

**application.yml**ï¼š
```yaml
server:
  port: 8761

spring:
  application:
    name: eureka-server

eureka:
  instance:
    hostname: localhost
  client:
    register-with-eureka: false
    fetch-registry: false
```

### 3. Config Server

**pom.xml**ï¼š
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-config-server</artifactId>
    </dependency>
</dependencies>
```

**application.yml**ï¼š
```yaml
server:
  port: 8888

spring:
  application:
    name: config-server
  cloud:
    config:
      server:
        native:
          search-locations: classpath:/config
  profiles:
    active: native
```

### 4. API Gateway

**pom.xml**ï¼š
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-gateway</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
    </dependency>
</dependencies>
```

**application.yml**ï¼š
```yaml
server:
  port: 8080

spring:
  application:
    name: api-gateway
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/api/users/**
          filters:
            - StripPrefix=2
        - id: product-service
          uri: lb://product-service
          predicates:
            - Path=/api/products/**
          filters:
            - StripPrefix=2
        - id: order-service
          uri: lb://order-service
          predicates:
            - Path=/api/orders/**
          filters:
            - StripPrefix=2
```

### 5. User Service

**pom.xml**ï¼š
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-config</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
    </dependency>
</dependencies>
```

**bootstrap.yml**ï¼š
```yaml
spring:
  application:
    name: user-service
  cloud:
    config:
      uri: http://localhost:8888
      profile: dev
```

**application.yml**ï¼š
```yaml
server:
  port: 8081

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/ecommerce?useSSL=false&serverTimezone=UTC
    username: root
    password: password
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
```

**UserController.java**ï¼š
```java
package com.example.user.controller;

import com.example.user.entity.User;
import com.example.user.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.getUser(id);
    }
    
    @PostMapping
    public User createUser(@RequestBody User user) {
        return userService.createUser(user);
    }
}
```

### 6. Product Service

ç±»ä¼¼ User Serviceï¼Œæä¾›å•†å“æŸ¥è¯¢åŠŸèƒ½ã€‚

### 7. Order Service

**pom.xml**ï¼ˆé¢å¤–æ·»åŠ  OpenFeignï¼‰ï¼š
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

**OrderController.java**ï¼š
```java
package com.example.order.controller;

import com.example.order.entity.Order;
import com.example.order.service.OrderService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/orders")
public class OrderController {
    
    @Autowired
    private OrderService orderService;
    
    @PostMapping
    public Order createOrder(@RequestBody Order order) {
        return orderService.createOrder(order);
    }
    
    @GetMapping("/{id}")
    public Order getOrder(@PathVariable Long id) {
        return orderService.getOrder(id);
    }
}
```

**ProductClient.java**ï¼š
```java
package com.example.order.client;

import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

@FeignClient(name = "product-service")
public interface ProductClient {
    
    @GetMapping("/products/{id}")
    Product getProduct(@PathVariable Long id);
}
```

### 8. Payment Service

ç±»ä¼¼å…¶ä»–æœåŠ¡ï¼Œæä¾›æ”¯ä»˜å¤„ç†åŠŸèƒ½ã€‚

## é…ç½®å„ç»„ä»¶

### 1. æœåŠ¡æ³¨å†Œ

æ‰€æœ‰æœåŠ¡éƒ½éœ€è¦æ³¨å†Œåˆ° Eureka Serverï¼Œé…ç½® `eureka.client.service-url.defaultZone`ã€‚

### 2. é…ç½®ä¸­å¿ƒ

æ‰€æœ‰æœåŠ¡ä» Config Server è·å–é…ç½®ï¼Œä½¿ç”¨ `bootstrap.yml` é…ç½® Config Server åœ°å€ã€‚

### 3. API ç½‘å…³è·¯ç”±

åœ¨ Gateway ä¸­é…ç½®æ‰€æœ‰æœåŠ¡çš„è·¯ç”±è§„åˆ™ã€‚

### 4. æœåŠ¡è°ƒç”¨

ä½¿ç”¨ OpenFeign è¿›è¡ŒæœåŠ¡é—´è°ƒç”¨ï¼Œé…ç½®ç†”æ–­é™çº§ã€‚

## æœåŠ¡é—´è°ƒç”¨

### Order Service è°ƒç”¨ Product Service

```java
@Service
public class OrderService {
    
    @Autowired
    private ProductClient productClient;
    
    public Order createOrder(Order order) {
        // è°ƒç”¨å•†å“æœåŠ¡è·å–å•†å“ä¿¡æ¯
        Product product = productClient.getProduct(order.getProductId());
        
        // åˆ›å»ºè®¢å•
        order.setProductName(product.getName());
        order.setPrice(product.getPrice());
        
        return orderRepository.save(order);
    }
}
```

### ç†”æ–­é™çº§é…ç½®

```yaml
resilience4j:
  circuitbreaker:
    configs:
      default:
        slidingWindowSize: 10
        failureRateThreshold: 50
    instances:
      productClient:
        baseConfig: default
```

```java
@FeignClient(
    name = "product-service",
    fallback = ProductClientFallback.class
)
public interface ProductClient {
    // ...
}
```

## æµ‹è¯•å’Œéƒ¨ç½²

### 1. å¯åŠ¨é¡ºåº

1. Eureka Server
2. Config Server
3. å„ä¸ªä¸šåŠ¡æœåŠ¡
4. API Gateway

### 2. æµ‹è¯•æ¥å£

```bash
# åˆ›å»ºç”¨æˆ·
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{"name":"å¼ ä¸‰","email":"zhangsan@example.com"}'

# æŸ¥è¯¢ç”¨æˆ·
curl http://localhost:8080/api/users/1

# åˆ›å»ºè®¢å•
curl -X POST http://localhost:8080/api/orders \
  -H "Content-Type: application/json" \
  -d '{"userId":1,"productId":1,"quantity":2}'
```

### 3. æŸ¥çœ‹æœåŠ¡æ³¨å†Œ

è®¿é—® http://localhost:8761 æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„æœåŠ¡ã€‚

### 4. æŸ¥çœ‹è¿½è¸ªæ•°æ®

è®¿é—® http://localhost:9411 æŸ¥çœ‹åˆ†å¸ƒå¼è¿½è¸ªæ•°æ®ã€‚

## å¸¸è§é—®é¢˜è§£å†³

### 1. æœåŠ¡æ— æ³•æ³¨å†Œ

**è§£å†³**ï¼š
- æ£€æŸ¥ Eureka Server æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥æœåŠ¡é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ç½‘ç»œæ˜¯å¦è¿é€š

### 2. é…ç½®æ— æ³•è·å–

**è§£å†³**ï¼š
- æ£€æŸ¥ Config Server æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥ `bootstrap.yml` é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨

### 3. æœåŠ¡è°ƒç”¨å¤±è´¥

**è§£å†³**ï¼š
- æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²æ³¨å†Œ
- æ£€æŸ¥ Feign å®¢æˆ·ç«¯é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥ç†”æ–­å™¨é…ç½®

### 4. ç½‘å…³è·¯ç”±ä¸ç”Ÿæ•ˆ

**è§£å†³**ï¼š
- æ£€æŸ¥è·¯ç”±é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²æ³¨å†Œ
- æ£€æŸ¥æ–­è¨€æ¡ä»¶æ˜¯å¦åŒ¹é…

## é¡¹ç›®ä¼˜åŒ–å»ºè®®

### 1. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± 
- ä¼˜åŒ– SQL æŸ¥è¯¢

### 2. å®‰å…¨ä¼˜åŒ–

- æ·»åŠ è®¤è¯æˆæƒï¼ˆSpring Security + OAuth2ï¼‰
- ä½¿ç”¨ HTTPS
- æ·»åŠ è¯·æ±‚é™æµ

### 3. ç›‘æ§ä¼˜åŒ–

- é›†æˆ Prometheus + Grafana
- æ·»åŠ ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
- è®¾ç½®å‘Šè­¦è§„åˆ™

### 4. éƒ¨ç½²ä¼˜åŒ–

- ä½¿ç”¨ Docker å®¹å™¨åŒ–
- ä½¿ç”¨ Kubernetes ç¼–æ’
- å®ç° CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²

## æ€»ç»“

é€šè¿‡è¿™ä¸ªå®Œæ•´çš„å®æˆ˜é¡¹ç›®ï¼Œæˆ‘ä»¬æ•´åˆäº† Spring Cloud çš„æ ¸å¿ƒç»„ä»¶ï¼š

- âœ… **æœåŠ¡æ³¨å†Œä¸å‘ç°**ï¼šä½¿ç”¨ Eureka å®ç°æœåŠ¡æ³¨å†Œå’Œå‘ç°
- âœ… **é…ç½®ç®¡ç†**ï¼šä½¿ç”¨ Config Server é›†ä¸­ç®¡ç†é…ç½®
- âœ… **API ç½‘å…³**ï¼šä½¿ç”¨ Gateway å®ç°ç»Ÿä¸€å…¥å£
- âœ… **æœåŠ¡è°ƒç”¨**ï¼šä½¿ç”¨ OpenFeign ç®€åŒ–æœåŠ¡è°ƒç”¨
- âœ… **ç†”æ–­é™çº§**ï¼šä½¿ç”¨ Resilience4j æé«˜ç³»ç»Ÿå®¹é”™èƒ½åŠ›
- âœ… **åˆ†å¸ƒå¼è¿½è¸ª**ï¼šä½¿ç”¨ Sleuth + Zipkin å®ç°é“¾è·¯è¿½è¸ª

æ­å–œä½ å®Œæˆäº† Spring Cloud 2025.0 çš„å­¦ä¹ ï¼ç°åœ¨ä½ å·²ç»å…·å¤‡äº†æ„å»ºå¾®æœåŠ¡ç³»ç»Ÿçš„èƒ½åŠ›ã€‚ç»§ç»­æ·±å…¥å­¦ä¹ ï¼Œæ¢ç´¢æ›´å¤š Spring Cloud çš„é«˜çº§ç‰¹æ€§å§ï¼

---

<div align="center">

â¬…ï¸ [ä¸Šä¸€ç« ï¼šåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª](../08-åˆ†å¸ƒå¼è¿½è¸ª/01-åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª.md) | ğŸ  [è¿”å›ç›®å½•](../../../README.md)

</div>

---

<p align="center">
  ğŸ‰ <strong>æ­å–œå®Œæˆå…¨éƒ¨è¯¾ç¨‹ï¼</strong> ğŸ‰
</p>

