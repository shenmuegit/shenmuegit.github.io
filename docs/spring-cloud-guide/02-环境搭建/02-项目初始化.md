# 项目初始化

本章将介绍如何创建一个 Spring Cloud 项目，包括父项目的创建、依赖管理和子模块的初始化。

## 创建父项目（Parent Project）

Spring Cloud 项目通常采用多模块结构，首先需要创建一个父项目来管理所有子模块的依赖版本。

### 1. 创建项目目录结构

```bash
mkdir spring-cloud-demo
cd spring-cloud-demo
```

### 2. 创建父项目 pom.xml

在项目根目录创建 `pom.xml` 文件：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>spring-cloud-demo</artifactId>
    <version>1.0.0</version>
    <packaging>pom</packaging>

    <name>Spring Cloud Demo</name>
    <description>Spring Cloud 2025.0 示例项目</description>

    <properties>
        <java.version>17</java.version>
        <maven.compiler.source>17</maven.compiler.source>
        <maven.compiler.target>17</maven.compiler.target>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <spring-boot.version>3.2.0</spring-boot.version>
        <spring-cloud.version>2025.0.0</spring-cloud.version>
    </properties>

    <!-- 子模块 -->
    <modules>
        <module>eureka-server</module>
        <module>service-provider</module>
        <module>service-consumer</module>
    </modules>

    <!-- 依赖管理 -->
    <dependencyManagement>
        <dependencies>
            <!-- Spring Boot 依赖管理 -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            <!-- Spring Cloud 依赖管理 -->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <build>
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.springframework.boot</groupId>
                    <artifactId>spring-boot-maven-plugin</artifactId>
                    <version>${spring-boot.version}</version>
                </plugin>
            </plugins>
        </pluginManagement>
    </build>
</project>
```

### 3. 关键配置说明

- **packaging**: 设置为 `pom`，表示这是一个父项目，不生成 jar 包
- **modules**: 定义所有子模块
- **dependencyManagement**: 统一管理依赖版本
- **properties**: 定义版本号等属性

## 配置 pom.xml 详解

### Spring Cloud 版本管理

Spring Cloud 使用 BOM（Bill of Materials）来管理版本，通过 `spring-cloud-dependencies` 可以统一管理所有 Spring Cloud 组件的版本。

### 常用 Spring Cloud 组件版本

在 `dependencyManagement` 中，Spring Cloud 会自动管理以下组件的版本：

- `spring-cloud-starter-netflix-eureka-server`
- `spring-cloud-starter-netflix-eureka-client`
- `spring-cloud-config-server`
- `spring-cloud-config-client`
- `spring-cloud-starter-gateway`
- `spring-cloud-starter-openfeign`
- `spring-cloud-starter-circuitbreaker-resilience4j`

## 创建子模块

### 1. Eureka Server 模块

创建 `eureka-server` 目录，并在其中创建 `pom.xml`：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.example</groupId>
        <artifactId>spring-cloud-demo</artifactId>
        <version>1.0.0</version>
    </parent>

    <artifactId>eureka-server</artifactId>
    <packaging>jar</packaging>

    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
    </dependencies>
</project>
```

### 2. Service Provider 模块

创建 `service-provider` 目录，创建 `pom.xml`：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.example</groupId>
        <artifactId>spring-cloud-demo</artifactId>
        <version>1.0.0</version>
    </parent>

    <artifactId>service-provider</artifactId>
    <packaging>jar</packaging>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>
    </dependencies>
</project>
```

### 3. Service Consumer 模块

创建 `service-consumer` 目录，创建 `pom.xml`：

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
         http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.example</groupId>
        <artifactId>spring-cloud-demo</artifactId>
        <version>1.0.0</version>
    </parent>

    <artifactId>service-consumer</artifactId>
    <packaging>jar</packaging>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-openfeign</artifactId>
        </dependency>
    </dependencies>
</project>
```

## 项目结构说明

完整的项目结构如下：

```
spring-cloud-demo/
├── pom.xml                          # 父项目 pom
├── eureka-server/                   # Eureka 服务注册中心
│   ├── pom.xml
│   └── src/
│       └── main/
│           ├── java/
│           │   └── com/example/eureka/
│           │       └── EurekaServerApplication.java
│           └── resources/
│               └── application.yml
├── service-provider/                 # 服务提供者
│   ├── pom.xml
│   └── src/
│       └── main/
│           ├── java/
│           │   └── com/example/provider/
│           │       ├── ProviderApplication.java
│           │       └── controller/
│           │           └── HelloController.java
│           └── resources/
│               └── application.yml
└── service-consumer/                 # 服务消费者
    ├── pom.xml
    └── src/
        └── main/
            ├── java/
            │   └── com/example/consumer/
            │       ├── ConsumerApplication.java
            │       └── controller/
            │           └── ConsumerController.java
            └── resources/
                └── application.yml
```

## 第一个 Spring Boot 应用

让我们创建一个简单的 Spring Boot 应用来验证项目配置。

### 1. 创建主类

在 `service-provider/src/main/java/com/example/provider/` 目录下创建 `ProviderApplication.java`：

```java
package com.example.provider;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class ProviderApplication {
    public static void main(String[] args) {
        SpringApplication.run(ProviderApplication.class, args);
    }
}
```

### 2. 创建 Controller

创建 `HelloController.java`：

```java
package com.example.provider.controller;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {
    
    @GetMapping("/hello")
    public String hello() {
        return "Hello from Service Provider!";
    }
}
```

### 3. 创建配置文件

在 `service-provider/src/main/resources/` 目录下创建 `application.yml`：

```yaml
server:
  port: 8081

spring:
  application:
    name: service-provider
```

### 4. 运行应用

在项目根目录执行：

```bash
mvn clean install
cd service-provider
mvn spring-boot:run
```

访问 http://localhost:8081/hello，应该看到 "Hello from Service Provider!"。

## Maven 常用命令

```bash
# 清理项目
mvn clean

# 编译项目
mvn compile

# 打包项目
mvn package

# 安装到本地仓库
mvn install

# 运行 Spring Boot 应用
mvn spring-boot:run

# 跳过测试
mvn install -DskipTests
```

## 常见问题

### 1. 依赖下载失败

**解决**：检查网络连接，配置 Maven 镜像源。

### 2. 版本冲突

**解决**：确保父项目的 `dependencyManagement` 正确配置，子模块不要指定版本号。

### 3. 编译错误

**解决**：检查 JDK 版本是否为 17+，IDE 中配置的 JDK 版本是否正确。

## 下一步

项目初始化完成后，我们可以开始学习 Spring Cloud 的核心组件了。请继续学习下一章节：[Eureka 服务注册中心](../03-服务注册与发现/01-Eureka-服务注册中心.md)。

